/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function s(t,a){for(var e=0;e<a.length;e++){var s=a[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(t,a,e){return a&&s(t.prototype,a),e&&s(t,e),t}}();function _classCallCheck(t,a){if(!(t instanceof a))throw new TypeError("Cannot call a class as a function")}var Form=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"init",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,a=null==t?box:t;module.conf.close_autocomplete&&a.find("input[type='text']").attr("autocomplete","off"),a.find("input[type='text']").each(function(){var t={this:$(this),class:"icon-input"};if(t.icon=t.this.data("icon"),null!=t.icon&&!t.this.hasClass("num-input")){if(-1!=t.icon.indexOf("|")){var a=t.icon.split("|");t.icon=a[0],t.class="right"==a[1]?t.class+"-right":t.class}t.this.parent().is("label")?(t.this.before('<i class="fa '+t.icon+'"></i>'),t.this.parent().addClass(t.class)):(t.this.before('<label class="'+t.class+'"></label>'),t.label=t.this.prev("label"),$('<i class="fa '+t.icon+'"></i>').appendTo(t.label),t.this.appendTo(t.label))}if(t.model=t.this.data("model"),null!=t.model&&i.input(t.this,t.model,!0),t.prepend=t.this.data("prepend"),null!=t.prepend){var e='<div class="input-group">\n\t\t\t\t\t\t\t\t<span class="prepend">'+t.prepend+"</span>\n\t\t\t\t\t\t\t</div>";t.this.before(e),t.this.appendTo(t.this.prev(".input-group"))}if(t.append=t.this.data("append"),null!=t.append){if(!t.this.parent().is(".input-group")){t.this.before('<div class="input-group"></div>'),t.this.appendTo(t.this.prev(".input-group"))}$('<span class="append">'+t.append+"</span>").appendTo(t.this.parent())}if(t.this.hasClass("num-input")){""==t.this.val()?(t.this.val(0),t.val=0):t.val=parseInt(t.this.val()),t.min=null==t.this.data("min")?0:parseInt(t.this.data("min")),t.max=null==t.this.data("max")?0:parseInt(t.this.data("max")),t.add=0<t.max&&t.val>=t.max?"disabled":"",t.cut=t.val<=t.min?"disabled":"",t.html='<span class="num-add-cut">\n\t\t\t\t\t\t\t<i class="fa fa-angle-up add '+t.add+'"></i>\n\t\t\t\t\t\t\t<i class="fa fa-angle-down cut '+t.cut+'"></i>\n\t\t\t\t\t\t</span>',t.this.before('<div class="input-group"></div>');var s=t.this.prev(".input-group");t.this.appendTo(s),$(t.html).appendTo(s)}}),a.find("textarea[maxlength]").each(function(){var t={this:$(this)};t.max=t.this.attr("maxlength"),t.len=t.this.text().length,t.html='<span class="font-num">'+t.len+" / "+t.max+"</span>",t.this.addClass("no-resize textarea-max").after(t.html)}),a.find(":radio").each(function(){var t={this:$(this),class:"radio"};t.class+=t.this.is(":disabled")?"-disabled":"",t.class+=t.this.is(":checked")?"-checked":"",t.this.parent().addClass(t.class),t.icon=t.this.is(":checked")?"dot-":"",t.html='<i class="fa fa-'+t.icon+'circle-o"></i>',t.this.before(t.html)}),a.find(":checkbox").each(function(){var t={this:$(this),class:"checkbox"};"switch"==t.this.data("model")?(t.checked="",t.this.is(":checked")?(t.checked=" switch-open",t.this.val(1)):t.this.val(0),t.disabled=t.this.is(":disabled")?" switch-disabled":"",t.html='<div class="checkbox-switch'+t.checked+t.disabled+'">\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</div>',t.this.parent().after(t.html)):(t.class+=t.this.is(":disabled")?"-disabled":"",t.class+=t.this.is(":checked")?"-checked":"",t.this.parent().addClass(t.class),t.icon=t.this.is(":checked")?"check-":"",t.html='<i class="fa fa-'+t.icon+'square-o"></i>',t.this.before(t.html))}),a.find("select").each(function(){var i={this:$(this),li:"",disabled:""};i.this.is(":disabled")&&(i.disabled=" select-disabled"),i.bind=i.this.data("bind"),null!=i.bind&&(i.child=a.find("#"+i.bind),0==i.child.length?console.log("没有找到绑定的ID为"+i.bind+"的子菜单"):i.child.attr("disabled",!0)),null!=i.this.data("width")?(i.width=i.this.data("width"),_.endsWith(i.width,"%")||(i.width+="px")):i.width=i.this.outerWidth()+"px",i.txt=i.this.find(":selected").text(),i.class=i.this.val()==module.conf.select_default_val||""!=i.disabled?"":"selected",i.html='<div style="width:'+i.width+';" class="select'+i.disabled+'" data-open="0">\n\t\t\t\t\t\t\t<span class="'+i.class+'">'+i.txt+'</span>\n\t\t\t\t\t\t\t<i class="fa fa-angle-down rotate"></i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div style="width:'+i.width+';" class="select-option animated faster">\n\t\t\t\t\t\t\t<ul class="iscroll">',i.this.children("option").each(function(){var t=$(this),a=t.val(),e=t.text(),s="";if(a==module.conf.select_default_val)return!0;t.is(":disabled")?s="disabled":t.is(":selected")&&(s="active"),i.li+='<li class="'+s+'" data-val="'+a+'">\n\t\t\t\t\t\t\t'+e+"\n\t\t\t\t\t\t</li>"}),i.html+=i.li+"</ul></div>",i.this.after(i.html)})}},{key:"event",value:function(){var t=[".select:not(.select-disabled)",".select-option",".select-option li:not(.disabled):not(.active)",".add, .cut",":radio",":checkbox",".checkbox-switch:not(.switch-disabled)"];body.on("click",t[0],function(){var t={this:$(this)};if(t.p=t.this.position(),t.o=t.this.next(".select-option"),t.oHeight=t.o.outerHeight(),t.oHeight+=10,t.o.css("left",t.p.left),distance(t.this,"bottom")<t.oHeight&&t.o.css("top",t.p.top-t.oHeight),t.open=1==t.this.data("open")?0:1,t.this.data("open",t.open),t.i=t.this.children("i"),0==t.open)return t.i.removeClass("rotate-180").addClass("rotate"),void fadeOut(t.o);t.i.removeClass("rotate").addClass("rotate-180"),fadeIn(t.o),t.o.attr("tabindex",0).focus()}).on("mouseover",t[0],function(){$(this).next(".select-option").data("active",1)}).on("mouseout",t[0],function(){$(this).next(".select-option").data("active",0)}).on("blur",t[1],function(){var t=$(this);1!=t.data("active")&&(t.prev().data("open",0).children("i").removeClass("rotate-180").addClass("rotate"),fadeOut(t))}).on("click",t[2],function(){var a={this:$(this)};a.val=a.this.data("val"),a.txt=a.this.html(),a.select=a.this.parent().parent().prev().prev(),a.select.val(a.val).next().children("span").addClass("selected").html(a.txt),a.this.addClass("active").siblings(".active").removeClass("active"),a.this.parent().parent().trigger("blur"),a.select.trigger("change"),a.bind=a.select.data("bind"),null!=a.bind&&(a.api=a.select.data("api"),null!=a.api&&""!=a.api?(a.child=$("#"+a.bind),a.child.next(".select").children("span").html('<i class="fa fa-spinner fa-pulse"></i>'),axios.get(a.api+=a.val).then(function(t){var e='<option value="'+module.conf.select_default_val+'"></option>',s="";_.each(t.data,function(t,a){e+='<option value="'+a+'">'+t+"</option>",s+='<li data-val="'+a+'">'+t+"</li>"}),a.child.html(e),a.child.next(".select").removeClass("select-disabled").children("span").html("请选择"),a.child.next().next().children("ul").html(s)}).catch(function(t){console.log(t)})):console.log("没有设置子菜单数据调用的API地址"))}).on("click",t[3],function(){var t={this:$(this)};if(!t.this.hasClass("disabled")){if(t.input=t.this.parent().prev(),t.min=null==t.input.data("min")?0:t.input.data("min"),t.max=null==t.input.data("max")?0:t.input.data("max"),t.step=null==t.input.data("step")?1:t.input.data("step"),t.val=parseInt(t.input.val()),t.this.hasClass("add"))return t.val+=parseInt(t.step),0<t.max&&t.val==t.max&&t.this.addClass("disabled"),t.input.val(t.val),void t.this.next().removeClass("disabled");t.val-=parseInt(t.step),t.val<=t.min&&t.this.addClass("disabled"),t.input.val(t.val),t.this.prev().removeClass("disabled")}}).on("mousedown",t[3],function(t){t.preventDefault()}).on("click",t[4],function(){var t={this:$(this)};t.radio=t.this.parent(),t.radio.hasClass("radio-checked")||(t.radio.removeClass("radio").addClass("radio-checked").children("i").attr("class","fa fa-dot-circle-o"),t.radio.siblings(".radio-checked").addClass("radio").removeClass("radio-checked").children("i").attr("class","fa fa-circle-o"))}).on("click",t[5],function(){var t={this:$(this)};t.checkbox=t.this.parent(),t.this.is(":checked")?t.checkbox.attr("class","checkbox-checked").children("i").attr("class","fa fa-check-square-o"):t.checkbox.attr("class","checkbox").children("i").attr("class","fa fa-square-o")}).on("click",t[6],function(){var t={this:$(this)};t.checkbox=t.this.prev().children(":checkbox"),t.checkbox.is(":checked")?(t.this.removeClass("switch-open"),t.checkbox.attr("checked",!1).val(0)):(t.this.addClass("switch-open"),t.checkbox.attr("checked",!0).val(1))}).on("submit","form",function(){var s={this:$(this)};return s.action=s.this.attr("action"),null==s.action?(console.log("提交的表单没有指定action参数，无法识别需要提交到哪里"),!1):(Validate.submit(s.this),!(0<s.this.find("span.error").length)&&(s.submit=s.this.find("[data-submit]"),0<s.submit.length&&null!=s.submit.data("loading")&&Button.loading(s.submit),null!=s.this.data("native")||(s.formData=s.this.serialize(),s.callback=s.this.data("callback"),axios.post(s.action,s.formData).then(function(t){var a=t.data;if(null!=a[module.conf.http.code_field]){var e="";if(null!=a[module.conf.http.msg_field]&&(e=a[module.conf.http.msg_field]),a[module.conf.http.code_field]==module.conf.http.code_success)return""==e&&(e="操作执行成功"),Eadmin.message.success({content:e,callback:function(){if(null!=s.callback)try{if(Method,!_.isFunction(Method[s.callback]))return void console.log("指定的"+s.callback+"不是一个可被调用的函数");Method[s.callback](s.submit)}catch(t){console.log(t)}}}),void Eadmin.button.reset(s.submit);""==e&&(e="操作执行失败"),Eadmin.message.error({content:e}),Eadmin.button.reset(s.submit)}else console.log("接口返回结果中没有找到定义的code码字段")}).catch(function(t){Eadmin.message.error({content:t})}),!1)))}),keyup($(".textarea-max"),function(t){var a=t.attr("maxlength"),e=t.val().length;a<e||t.next().html(e+" / "+a)})}},{key:"checkbox",value:function(t,a){var e={};e=1==a?{checked:!0,i_class:"fa fa-check-square-o",class:"checkbox-checked"}:{checked:!1,i_class:"fa fa-square-o",class:"checkbox"},t.prop("checked",e.checked).prev("i").attr("class",e.i_class).parent("label").attr("class",e.class)}},{key:"select",value:function(t){var a=t.find("select");0!=a.length&&a.each(function(){var t={this:$(this)};t.txt=t.this.children("option:first").text(),t.this.val(module.conf.select_default_val).next().children("span").removeClass("selected").html(t.txt),t.this.next().next().find(".active").removeClass("active")})}},{key:"input",value:function(t,a){var e=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(a!=t.data("model")||e)if(null!=a){null==t.data("model")?t.addClass("color-input"):(t.parent().removeClass(t.data("model")+"-input"),t.prev("i").remove()),t.data("model",a);var s="";switch(a){case"success":s="fa-check-circle";break;case"error":s="fa-times-circle";break;case"notice":s="fa-exclamation-circle"}if(t.parent().is("label")||t.hasClass("num-input"))t.parent().addClass(a+"-input"),t.hasClass("num-input")||(t.prev("i").hide(),t.before('<i class="fa '+s+'"></i>'));else{t.before('<label class="'+a+'-input"></label>');var i=t.prev("label");$('<i class="fa '+s+'"></i>').appendTo(i),t.appendTo(i)}}else t.hasClass("num-input")?(t.removeData("model").removeClass("color-input"),t.parent().attr("class","input-group")):(a=t.data("model"),t.removeData("model").removeClass("color-input").prev("i").remove(),0==t.prev("i").length?t.parent().removeAttr("class"):t.prev("i").show().parent().removeClass(a+"-input"))}},{key:"textarea",value:function(t,a){var e=2<arguments.length&&void 0!==arguments[2]&&arguments[2];if(a!=t.data("model")||e)if(null!=a)if(null==t.data("model")&&t.addClass("color-input"),t.data("model",a),t.parent().is("label"))t.parent().attr("class",a+"-input");else{t.before('<label class="'+a+'-input"></label>');var s=t.prev("label");t.appendTo(s)}else t.removeData("model").removeClass("color-input").parent().removeAttr("class")}}]),i}();