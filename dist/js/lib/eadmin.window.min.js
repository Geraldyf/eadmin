/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function o(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,i){return n&&o(t.prototype,n),i&&o(t,i),t}}();function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var Window=function(){function o(t,n){_classCallCheck(this,o),this.window="",this.windowDom=null,this.dom=0!=t&&scope(t),this.x=0,this.y=0,this.top=0,this.left=0;var i={url:"",model:"load",width:module.conf.window_width,height:module.conf.window_height,title:module.conf.window_title,drag:!0,btn:[],close:null,submit:null};this.param=$.extend(!0,i,n),this.run()}return _createClass(o,[{key:"run",value:function(){this._event()}},{key:"_create",value:function(){var i={id:createId(),width:0,height:0,style:"",drag:"",html:""};this.window="window-"+i.id,_.isInteger(this.param.width)||-1==this.param.width.indexOf("%")?i.width=this.param.width:i.width=innerW()*(parseInt(this.param.width.replace("%",""))/100),_.isInteger(this.param.height)||-1==this.param.height.indexOf("%")?i.height=this.param.height:i.height=innerH()*(parseInt(this.param.height.replace("%",""))/100),i.style='style="width:'+i.width+"px;height:"+i.height+"px;margin-left:-"+i.width/2+"px;margin-top:-"+i.height/2+'px;"',this.param.drag&&(i.drag=' style="cursor: move;"'),i.height-=55,0<this.param.btn.length&&(i.height-=50),i.html='<div id="window-'+i.id+'" \n\t\t\t\t\t\tclass="window animated faster'+(null==Mount.window?"":" "+Mount.window)+' dn" '+i.style+'>\n\t\t\t\t\t<div class="window-loading dn">\n\t\t\t\t\t\t<i class="fa fa-spinner fa-pulse mr5"></i>页面加载中，请稍候...\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="window-close">\n\t\t\t\t\t\t<i class="fa fa-times-circle"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="title"'+i.drag+">\n\t\t\t\t\t\t<span>"+this.param.title+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="body" style="height:'+i.height+'px;"></div>',0<this.param.btn.length&&(i.html+='<div class="btnbar">',_.each(this.param.btn,function(t){var n=-1==["cancel","refresh"].indexOf(t.action)?' data-loading="执行中..."':"";i.html+="<button\n\t\t\t\t\t\t\t\t"+(_.has(t,"highlight")?' class="highlight"':"")+"\n\t\t\t\t\t\t\t\t"+n+("submit"==t.action?" data-submit":"")+">\n\t\t\t\t\t\t\t"+t.name+"\n\t\t\t\t\t\t\t</button>"}),i.html+="</div>"),i.html+="</div>",body.append(i.html),this.windowDom=$("#"+this.window)}},{key:"_event",value:function(){var a=this,i={},e={close:function(){a.windowDom.remove(),Mount.window=null,$("."+a.window).remove(),Eadmin.maskHide(),null!=a.param.close&&_.isFunction(a.param.close)&&a.param.close()},load:function(){if("iframe"!=a.param.model)i.loading.show(),setTimeout(function(){null!=i.scroll&&(i.scroll.destroy(),i.scroll=null),Mount.window=a.window,i.body.load(a.param.url,function(){i.loading.hide(),Eadmin.form(i.body),Button.run(a.windowDom),Status.run(i.body),Tag.run(i.body),i.scroll=Eadmin.scroll("#"+a.window+" .body");var t=body.find(".iscroll");0<t.length&&t.each(function(){if($(this).hasClass("ps"))return!0;Eadmin.scroll($(this)[0])})})},100);else{var t='<iframe \n\t\t\t\t\t\t\t\t\tsrc="'+a.param.url+'" \n\t\t\t\t\t\t\t\t\twidth="100%" \n\t\t\t\t\t\t\t\t\theight="100%" \n\t\t\t\t\t\t\t\t\tframeborder="0" scrolling="auto">\n\t\t\t\t\t\t\t\t</iframe>';i.body.html(t)}},init:function(t){if(a._create(),i={this:t,title:a.windowDom.children(".title"),body:a.windowDom.children(".body"),loading:a.windowDom.children(".window-loading"),scroll:null},0!=t&&(a.param.url=i.this.data("window-url")),null!=a.param.url&&""!=a.param.url){var n=Eadmin.mask();0!=n&&a.windowDom.css("z-index",n),a.windowDom.off("animationend").show().addClass("zoomIn"),e.load(),a.windowDom.children(".window-close").on("click",function(){e.close()}),a.param.drag&&i.title.on("mousedown",function(t){var n=a.windowDom.offset();a.x=t.clientX,a.y=t.clientY,a.top=n.top,a.left=n.left;var o=a.windowDom.css("margin-left"),e=a.windowDom.css("margin-top");o=parseInt(o),e=parseInt(e),$(document).on("mousemove",function(t){var n=a.top+(t.clientY-a.y),i=a.left+(t.clientX-a.x);n-=e,i-=o,a.windowDom.css({top:n,left:i})})}).on("mouseup",function(){$(document).off("mousemove")}),0!=a.param.btn.length&&a.windowDom.children(".btnbar").children("button").on("click",function(){var o={this:$(this)};if(o.index=o.this.index(),o.param=a.param.btn[o.index],_.isString(o.param.action)){if(o.action=["cancel","refresh","submit"],-1==o.action.indexOf(o.param.action))return void console.log("没有找到内置按钮事件："+o.param.action);switch(o.param.action){case"cancel":e.close();break;case"refresh":i.body.empty(),e.load();break;case"submit":var t=function(){i.form=i.body.find("form"),0!=i.form.length?(i.action=i.form.attr("action"),null==i.action&&(i.action=a.param.url),Validate.submit(i.form),0<i.form.find("span.error").length||(Eadmin.button.loading(o.this),i.formData=i.form.serialize(),axios.post(i.action,i.formData).then(function(t){var n=t.data;if(null!=n[module.conf.http.code_field]){var i="";if(null!=n[module.conf.http.msg_field]&&(i=n[module.conf.http.msg_field]),n[module.conf.http.code_field]==module.conf.http.code_success)return i=""==i?"操作执行成功":i,e.close(!1),Eadmin.popup.success({content:i,callback:function(){!0===o.param.refresh_on_close&&Eadmin.refresh()}}),void Eadmin.button.reset(o.this);""==i&&(i="操作执行失败"),Eadmin.message.error({content:i}),Eadmin.button.reset(o.this)}else console.log("接口返回结果中没有找到定义的code码字段")}).catch(function(t){Eadmin.message.error({content:t}),Eadmin.button.reset(o.this)}))):console.log("窗体内没有找到form表单元素，提交表单失败")};if(null!=o.param.before)return null==Method||null==Method[o.param.before]?(console.log("弹窗页面中没有找到指定的前置方法"+o.param.before),!1):void Method[o.param.before](t);t()}}else o.param.action({close:function(){setTimeout(function(){Eadmin.button.reset(o.this)},100),e.close()},refresh:function(){setTimeout(function(){Eadmin.button.reset(o.this)},100),i.body.empty(),e.load()}})})}else console.log("没有指定弹窗地址，打开失败")}};0!=a.dom?a.dom.on("click",function(){e.init($(this))}):e.init(!1)}}]),o}();