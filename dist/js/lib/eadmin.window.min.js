/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function e(t,n){for(var i=0;i<n.length;i++){var e=n[i];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var Window=function(){function o(t,n){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];_classCallCheck(this,o),this.window=null,this.windowDom="",this.dom=t,this.x=0,this.y=0,this.top=0,this.left=0,this.bind=i;var e={url:"",refresh:!1,model:"load",width:module.conf.window_width,height:module.conf.window_height,title:module.conf.window_title,drag:!0,btn:[],close:null,submit:null};this.param=$.extend(!0,e,n),this.run()}return _createClass(o,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var i={width:0,height:0,style:"",drag:"",html:""};i.dom=_.replace(this.dom,"#",""),i.dom=_.replace(i.dom,".",""),this.windowDom="#window-"+i.dom,this.window=$(this.windowDom),this.bind||0<this.window.length&&this.window.off().remove(),_.isInteger(this.param.width)||-1==this.param.width.indexOf("%")?i.width=this.param.width:i.width=innerW()*(parseInt(this.param.width.replace("%",""))/100),_.isInteger(this.param.height)||-1==this.param.height.indexOf("%")?i.height=this.param.height:i.height=innerH()*(parseInt(this.param.height.replace("%",""))/100),i.style='style="width:'+i.width+"px;height:"+i.height+"px;margin-left:-"+i.width/2+"px;margin-top:-"+i.height/2+'px;"',this.param.drag&&(i.drag=' style="cursor: move;"'),i.height-=55,0<this.param.btn.length&&(i.height-=45),i.html='<div id="window-'+i.dom+'" \n\t\t\t\t\t\tdata-refresh="'+this.param.refresh+'" \n\t\t\t\t\t\tclass="window animated faster dn" '+i.style+'>\n\t\t\t\t\t<div class="window-loading dn">\n\t\t\t\t\t\t<i class="fa fa-spinner fa-pulse mr5"></i>页面加载中，请稍候...\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="window-close">\n\t\t\t\t\t\t<i class="fa fa-times-circle"></i>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="title"'+i.drag+">\n\t\t\t\t\t\t<span>"+this.param.title+'</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="body" style="height:'+i.height+'px;"></div>',0<this.param.btn.length&&(i.html+='<div class="btnbar">',_.each(this.param.btn,function(t){var n=-1==["cancel","refresh"].indexOf(t.action)?' data-loading="执行中..."':"";i.html+="<button\n\t\t\t\t\t\t\t\t"+(_.has(t,"highlight")?' class="highlight"':"")+"\n\t\t\t\t\t\t\t\t"+n+("submit"==t.action?" data-submit":"")+">\n\t\t\t\t\t\t\t"+t.name+"\n\t\t\t\t\t\t\t</button>"}),i.html+="</div>"),i.html+="</div>",body.append(i.html),this.window=$(this.windowDom)}},{key:"_event",value:function(){var a=this,n={title:a.window.children(".title"),body:a.window.children(".body"),loading:a.window.children(".window-loading"),scroll:null},o=function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];a.window.removeClass("zoomIn").hide(),"load"==a.param.model&&n.loading.hide(),a.param.refresh&&(n.body.empty(),n.scroll.destroy(),n.scroll=null),Eadmin.maskHide(),t&&null!=a.param.close&&_.isFunction(a.param.close)&&a.param.close()},i=function(){if("iframe"!=a.param.model)n.loading.show(),setTimeout(function(){null!=n.scroll&&(n.scroll.destroy(),n.scroll=null),n.body.load(a.param.url,function(){n.loading.hide(),Eadmin.form(n.body),Button.run(a.window),n.scroll=Eadmin.scroll(a.windowDom+" .body");var t=n.body.find(".iscroll");0<t.length&&t.each(function(){Eadmin.scroll($(this)[0])})})},100);else{var t='<iframe \n\t\t\t\t\t\t\t\t\tsrc="'+a.param.url+'" \n\t\t\t\t\t\t\t\t\twidth="100%" \n\t\t\t\t\t\t\t\t\theight="100%" \n\t\t\t\t\t\t\t\t\tframeborder="0" scrolling="auto">\n\t\t\t\t\t\t\t\t</iframe>';n.body.html(t)}};if(0<a.param.btn.length&&(n.btn=a.window.children(".btnbar").children("button")),n.close=a.window.children(".window-close"),a.bind)box.on("click",a.dom,function(){var t={this:$(this)};t.url=t.this.data("window-url"),null!=t.url&&""!=t.url?(a.param.url=t.url,a.window.off("animationend").show().addClass("zoomIn"),Eadmin.mask(),(""==n.body.html()||a.param.refresh)&&i()):console.log("没有指定弹窗地址，打开失败")});else{if(a.window.off("animationend").show().addClass("zoomIn"),Eadmin.mask(),""!=n.body.html()&&!a.param.refresh)return;i()}n.close.on("click",function(){o()}),a.param.drag&&n.title.on("mousedown",function(t){var n=a.window.offset();a.x=t.clientX,a.y=t.clientY,a.top=n.top,a.left=n.left;var e=a.window.css("margin-left"),o=a.window.css("margin-top");e=parseInt(e),o=parseInt(o),$(document).on("mousemove",function(t){var n=a.top+(t.clientY-a.y),i=a.left+(t.clientX-a.x);n-=o,i-=e,a.window.css({top:n,left:i})})}).on("mouseup",function(){$(document).off("mousemove")}),0!=a.param.btn.length&&n.btn.on("click",function(){var e={this:$(this)};if(e.index=e.this.index(),e.param=a.param.btn[e.index],_.isString(e.param.action)){if(e.action=["cancel","refresh","submit"],-1==e.action.indexOf(e.param.action))return void console.log("没有找到内置按钮事件："+e.param.action);switch(e.param.action){case"cancel":o(!1);break;case"refresh":n.body.empty(),i();break;case"submit":var t=function(){n.form=n.body.find("form"),0!=n.form.length?(n.action=n.form.attr("action"),null==n.action&&(n.action=a.param.url),Validate.submit(n.form),0<n.form.find("span.error").length||(Eadmin.button.loading(e.this),n.formData=n.form.serialize(),axios.post(n.action,n.formData).then(function(t){var n=t.data;if(null!=n[module.conf.http.code_field]){var i="";if(null!=n[module.conf.http.msg_field]&&(i=n[module.conf.http.msg_field]),n[module.conf.http.code_field]==module.conf.http.code_success)return i=""==i?"操作执行成功":i,o(!1),Eadmin.popup.success({content:i,callback:function(){!0===e.param.refresh_on_close&&Eadmin.refresh()}}),void Eadmin.button.reset(e.this);""==i&&(i="操作执行失败"),Eadmin.message.error({content:i}),Eadmin.button.reset(e.this)}else console.log("接口返回结果中没有找到定义的code码字段")}).catch(function(t){Eadmin.message.error({content:t}),Eadmin.button.reset(e.this)}))):console.log("窗体内没有找到form表单元素，提交表单失败")};if(null!=e.param.before)return null==Method||null==Method[e.param.before]?(console.log("弹窗页面中没有找到指定的前置方法"+e.param.before),!1):void Method[e.param.before](t);t()}}else e.param.action({close:function(){setTimeout(function(){Eadmin.button.reset(e.this)},100),o()},refresh:function(){setTimeout(function(){Eadmin.button.reset(e.this)},100),n.body.empty(),i()}})})}}]),o}();