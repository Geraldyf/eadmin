/*!
 eadmin极速后台UI框架（我只想要个后台） | @author:317953536@qq.com 
*/
"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Citypikcer=function(){function i(e,t){if(_classCallCheck(this,i),"undefined"==typeof city_data_init)return console.log("没有检测到城市选择器必须的城市数据"),!1;this.input=e,this.inputDom=scope(this.input),this.picker=null,this.index=0,this.scrollTop=0,this.init=!1,this.level=1,this.prov=0;if(this.param=$.extend({type:1,format:" / ",level:3,change:null},t),0==this.inputDom.length)return console.log("当前页面中不包含"+this.input+"元素，创建失败"),!1;this.run()}return _createClass(i,[{key:"run",value:function(){this._create(),this._event()}},{key:"_create",value:function(){var e=createId(),t='<div id="citypicker-'+e+'" class="citypicker animated faster'+(null==Mount.window?"":" "+Mount.window)+' dn"';1==this.param.type?(t+=' style="width:472px;">',t+='<span class="title">Tips：输入城市拼音首字母可快速选择，例如：hf</span>\n\t\t\t<div class="header">\n\t\t\t\t<span class="current">热门</span>\n\t\t\t\t<span>ABC</span>\n\t\t\t\t<span>DEF</span>\n\t\t\t\t<span>GHI</span>\n\t\t\t\t<span>JKL</span>\n\t\t\t\t<span>MNO</span>\n\t\t\t\t<span>PQR</span>\n\t\t\t\t<span>STU</span>\n\t\t\t\t<span>VWX</span>\n\t\t\t\t<span>YZ</span>\n\t\t\t</div>\n\t\t\t<div class="body"></div>\n\t\t\t<div class="quick iscroll dn"></div>'):(t+=">",t+='<div class="vert iscroll"></div>'),t+="</div>",body.append(t),this.picker=$("#citypicker-"+e),2==this.param.type&&this.picker.css("padding","5px")}},{key:"_event",value:function(){var a=this,e=[".header span:not(.current):not(.not-allow)",".body span, .quick span",".vert span"],r={};r=1==a.param.type?{body:a.picker.children(".body"),header:a.picker.children(".header"),quick:a.picker.children(".quick")}:{body:a.picker.children(".vert")},this.inputDom.on("focus",function(){a.init||(a._formatData(r.body),a.init=!0),fadeIn(a.picker,$(this),!1),clear=!0}).on("blur",function(){a.focus||(fadeOut(a.picker),clear=!1)}),keyup(this.inputDom,function(e,t){var n={val:e.val(),key:t.keyCode};if(1==a.param.type)return""!=n.val&&(64<n.key&&n.key<91||8==n.key||32==n.key)?(a.picker.is(":hidden")&&fadeIn(a.picker,e,!1),r.quick.is(":hidden")&&(a.picker.data("left",a.picker.css("left")).css("left",e.offset().left).width(158).children(".title").html(" ↑ ↓ 键快速选择城市"),a.picker.children(".header, .body").hide(),a.picker.children(".quick").show()),n.html="",$.each(cp_b,function(e,t){if(-1!=t.indexOf(n.val)){var i=t.split("@");n.html+="<span>"+i[0]+"</span>"}}),void a.picker.children(".quick").html(n.html)):void(""==n.val&&a._reset());a.level=1,a.picker.children(".vert:first").nextAll(".vert").remove(),""!=n.val?(n.html="",n.icon="",2==a.param.type&&1<a.param.level&&(n.icon='<i class="ri-arrow-right-s-line"></i>'),$.each(cp_d,function(e,t){if(-1!=t.indexOf(n.val)){var i=t.split("@");n.html+='<span data-c="'+i[0]+'" data-i="'+e+'">'+i[0]+n.icon+"</span>"}}),a.picker.children(".vert:first").html(n.html)):a._formatData(r.body)}),1==a.param.type&&a.inputDom.on("keydown",function(e){if(-1!=_.indexOf([13,38,40],e.keyCode)&&!r.quick.is(":hidden")){var t=r.quick.children("span");if(13!=e.keyCode){38==e.keyCode&&(a.index<0&&(a.index=t.length-1),a.index-=1),40==e.keyCode&&(a.index!=t.length-1&&0!=r.quick.children(".current").length||(a.index=-1),a.index+=1),a.index<0&&(a.scrollTop=r.quick[0].scrollHeight-r.quick.height(),r.quick.scrollTop(a.scrollTop)),0==a.index&&(a.scrollTop=0,r.quick.scrollTop(0)),t.eq(a.index).addClass("current").siblings().removeClass("current");var i=t.eq(a.index).position().top;200<i&&0<=a.index?(a.scrollTop+=215,r.quick.scrollTop(a.scrollTop)):i<=0&&(a.scrollTop-=215,r.quick.scrollTop(a.scrollTop))}else a._setVal(t.eq(a.index).html())}}),a.picker.on("blur",function(){a.inputDom.blur(),fadeOut(a.picker),clear=!1}).on("click",e[0],function(){var e={this:$(this)};e.city=cp_a[e.this.index()],addClassExc(e.this,"current"),a._formatData(r.body,e.city)}).on("click",e[1],function(){a._setVal($(this).html())}).on("click",e[2],function(){var e={this:$(this)};if(e.val=e.this.data("c"),1!=a.param.level){if(addClassExc(e.this,"current"),e.parent=e.this.parent(),a.level=e.parent.index()+1,a.level==a.param.level)return e.val="",e.doc="",a.picker.find(".current").each(function(){e.val+=e.doc+$(this).data("c"),e.doc=a.param.format}),void a._setVal(e.val);e.parent.nextAll(".vert").remove(),e.index=e.this.data("i"),e.next=e.parent.next(".vert"),0==e.next.length&&(a.level+=1,a.picker.append('<div class="vert"></div>'),e.next=a.picker.children(".vert:last"),Eadmin.scroll(e.next[0])),e.source=null,2==a.level?(a.prov=e.index,e.source=cp_c[e.index].sub):e.source=cp_c[a.prov].sub[e.index].sub,a._formatData(e.next,e.source,!0)}else a._setVal(e.val)}).on("mousedown",function(e){e.preventDefault()})}},{key:"_formatData",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n=void 0;if(null!=t)if(n=[],i)for(var a in t)n[a]=t[a].name;else n=t;else if(1==this.param.type)n=cp_a[0];else for(var r in n=[],cp_c)n[r]=cp_c[r].name;var l="",c="";for(var s in 2==this.param.type&&this.level<this.param.level&&(c='<i class="ri-arrow-right-s-line"></i>'),n)l+='<span data-c="'+n[s]+'" data-i="'+s+'">'+n[s]+c+"</span>";e.html(l)}},{key:"_setVal",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.inputDom.val(t),this.focus=!1,this.picker.trigger("blur"),this._callback(t),2!=this.param.type&&(this.picker.children(".quick").is(":hidden")||setTimeout(function(){e._reset()},500))}},{key:"_reset",value:function(){this.picker.width(450).children(".title").html("Tips：输入城市拼音首字母可快速选择，例如：hf"),null!=this.picker.data("left")&&this.picker.css("left",this.picker.data("left")),this.picker.children(".header, .body").show(),this.picker.children(".quick").hide()}},{key:"_callback",value:function(e){null!=this.param.change&&_.isFunction(this.param.change)&&this.param.change(e)}}]),i}();